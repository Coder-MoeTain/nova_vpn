<p align="center">
  <strong>NovaVPN</strong>
</p>
<p align="center">
  Android VPN app using WireGuard — one-tap connect, no config screens.
</p>
<p align="center">
  <sub>Kotlin · Jetpack Compose · Material 3 · WireGuard</sub>
</p>

---


## Table of Contents

- [About](#about)
- [Requirements](#requirements)
- [Getting Started](#getting-started)
- [Project Structure](#project-structure)
- [Configuration](#configuration)
- [Keys & Security](#keys--security)
- [Verifying the VPN](#verifying-the-vpn)
- [Troubleshooting](#troubleshooting)
- [Features](#features)
- [Tech Stack](#tech-stack)
- [Provisioning API](#provisioning-api)
- [License](#license)

---

## About

NovaVPN is a production-ready Android VPN client built on **WireGuard**. Users connect with a single tap; keys and config are managed inside the app. No external WireGuard app is required.

- **Target:** Android 8+ (API 26+)
- **Security:** Client private key stored in EncryptedSharedPreferences; no keys in logs

---

## Requirements

- Android Studio (latest stable)
- Android device with **API 26+** (VPN does not work on the emulator)
- USB debugging enabled (for running from Android Studio)

---

## Getting Started

### 1. Clone and open

```bash
git clone <your-repo-url>
cd android-vpn
```

Open the `android-vpn` folder in Android Studio and let Gradle sync.

### 2. Gradle wrapper (if missing)

If there is no `gradlew` / `gradlew.bat`:

- **Android Studio:** File → Settings → Build → Gradle → use project Gradle
- **Terminal:** `gradle wrapper --gradle-version 8.9`

### 3. Run on device

1. Connect an Android device with USB debugging enabled.
2. **Run → Run 'app'** (or click the Run button).
3. On first launch, grant **VPN** permission when prompted.
4. Tap **Connect** — the app uses an embedded server config (see [Configuration](#configuration)).

---

## Project Structure

```
android-vpn/
├── app/
│   ├── build.gradle.kts
│   └── src/main/
│       ├── AndroidManifest.xml
│       ├── java/com/novavpn/app/
│       │   ├── di/           # Hilt modules
│       │   ├── data/         # Config, repositories
│       │   ├── security/     # Key generation, secure storage
│       │   ├── ui/           # Compose screens, theme
│       │   ├── util/         # Logger
│       │   ├── viewmodel/    # VpnViewModel, Settings, Logs
│       │   └── vpn/          # Tunnel, WireGuard, config builder
│       └── res/
│           ├── drawable/
│           ├── raw/           # Lottie (optional)
│           └── values/
├── build.gradle.kts
├── settings.gradle.kts
└── README.md
```

---

## Configuration

### Provisioning API (recommended for multiple users)

When a user taps **Connect**, the app can register the device with your backend and get a unique config (no manual key exchange). Set your backend URL in `app/build.gradle.kts`:

```kotlin
buildConfigField("String", "PROVISIONING_BASE_URL", "\"https://your-vpn-server.com\"")
```

See [Provisioning API](#provisioning-api) below for the backend contract. If provisioning fails (e.g. no network or URL not set), the app falls back to the embedded config.

### Embedded fallback

The app ships with an **embedded** server config used when provisioning is not available:

| Setting            | Value                          |
|--------------------|--------------------------------|
| **Endpoint**       | 194.31.53.236:64120 (UDP)      |
| **Server public key** | In code (see `WireGuardManager`) |
| **Client addresses**  | 10.66.66.2/32, fd42:42:42::2/128 |
| **DNS**            | 1.1.1.1, 1.0.0.1               |
| **Allowed IPs**     | 0.0.0.0/0, ::/0 (full tunnel)  |
| **Keepalive**      | 25                             |

To use your own server without provisioning, edit `WireGuardManager.getEmbeddedConfig()` and ensure the server’s WireGuard config includes this client’s **public key** (see [Keys & Security](#keys--security)).

---

## Keys & Security

| Key                         | Generated by   | Where it lives                          |
|----------------------------|----------------|-----------------------------------------|
| **Client private key**     | **App** (first run) | Device only (EncryptedSharedPreferences) |
| **Client public key**       | Derived from private key | Must be added on the **server** config   |
| **Server private key**     | Not by the app | On the VPN server only                  |
| **Server public key**      | On the server  | In app config (`getEmbeddedConfig()`)   |

The app generates the **client** key by itself. It does **not** run a VPN server; it only connects to a remote WireGuard server. The tunnel works only if that server is up and has this device’s **client public key** in its `[Peer]` section.

---

## Verifying the VPN

1. **In the app:** Status shows **Connected** and the duration counter increases.
2. **In the browser:** Open [ifconfig.me](https://ifconfig.me) or [api.ipify.org](https://api.ipify.org) — the IP should be the VPN server’s exit IP.
3. **System:** Settings → Network & internet → VPN — NovaVPN should appear as connected.

---

## Troubleshooting

| Problem | What to try |
|--------|-------------|
| **VPN permission denied** | Grant VPN permission when prompted; if you dismissed it, clear app data or reinstall and tap Connect again. |
| **No error but tunnel not working** | Ensure the embedded server is a real WireGuard server, is reachable, has this device’s **client public key** in its config, and that UDP 64120 is open. |
| **Handshake / connection fails** | Check server reachability, firewall, and that the server’s config includes the client public key. |
| **No internet over VPN** | Check server NAT/firewall and that it forwards traffic (e.g. full tunnel `AllowedIPs = 0.0.0.0/0, ::/0` on server). |
| **Quick Settings tile missing** | Edit Quick Settings and add the **NovaVPN** tile. |

---

## Features

- **One-tap Connect/Disconnect** — States: Disconnected, Connecting, Connected, Disconnecting, Error.
- **Connection stats** — Duration, public IP, downloaded/uploaded bytes when connected.
- **Settings** — Auto-connect on boot; guidance for Always-on VPN and kill switch.
- **Logs** — Connection and app events (no secrets logged).
- **Notification** — When VPN is connected.
- **Quick Settings tile** — Connect/disconnect from the shade.

---

## Tech Stack

| Area        | Technology |
|------------|------------|
| **VPN**    | `com.wireguard.android:tunnel` |
| **UI**     | Jetpack Compose, Material 3, Navigation Compose |
| **DI**     | Hilt |
| **Storage**| AndroidX Security Crypto (EncryptedSharedPreferences) |
| **Logging**| Timber |
| **Animations** | Compose animations, Lottie (optional) |

---

## Provisioning API

Use this so **each user gets a config automatically** (e.g. share the app with friends; no one sends keys to an admin).

### App behaviour

1. On first **Connect**, the app generates a device key and **POST**s the **public key** to `{PROVISIONING_BASE_URL}/provision`.
2. Your backend adds a new WireGuard peer for that key, assigns a unique client IP, and returns the config.
3. The app caches the response and uses it for future connects. If the request fails, it falls back to the embedded config.

### Backend contract

- **URL:** `POST {baseUrl}/provision` (no trailing slash on baseUrl).
- **Request body (JSON):**
  ```json
  { "publicKey": "<base64 WireGuard public key>" }
  ```
- **Response (JSON):**
  ```json
  {
    "endpointHost": "vpn.example.com",
    "endpointPort": 51820,
    "serverPublicKey": "<server's WireGuard public key, base64>",
    "clientAddress": "10.66.66.3/32,fd42:42:42::3/128",
    "dns": "1.1.1.1, 1.0.0.1",
    "allowedIPs": "0.0.0.0/0, ::/0",
    "persistentKeepalive": 25,
    "presharedKey": null
  }
  ```
  - `clientAddress`: unique per device (e.g. 10.66.66.2/32 for device 1, 10.66.66.3/32 for device 2). Include IPv6 if your server uses it.
  - `presharedKey`: optional; omit or set to `null` if not used.

### Backend implementation outline

1. Receive `publicKey` from the request.
2. Choose a free client IP (e.g. next free in 10.66.66.0/24) and build the `clientAddress` string.
3. Add a new `[Peer]` to your WireGuard server config (or use `wg`/API): `PublicKey = <publicKey>`, `AllowedIPs = <clientAddress>`.
4. Reload or apply the WireGuard config on the server.
5. Return the JSON above (same endpoint/server key/dns/allowedIPs for all; only `clientAddress` and optionally `presharedKey` vary per peer).

Set `PROVISIONING_BASE_URL` in `app/build.gradle.kts` to your backend’s base URL (e.g. `https://vpn.example.com`).

### Ready-to-run Node.js backend

A **Node.js provisioning server** is included in this repo:

- **Location:** `provisioning-server/`
- **Run:** `cd provisioning-server && cp .env.example .env` (edit `.env` with your WireGuard server public key and endpoint), then `npm install && npm start`.
- **Details:** See [provisioning-server/README.md](provisioning-server/README.md). The server runs on the same machine as your WireGuard server, adds peers via `wg set`, and returns the config the app expects. Set `PROVISIONING_BASE_URL` in the app to this server's URL (e.g. `http://YOUR_SERVER_IP:3000` or an HTTPS URL if you put it behind a reverse proxy).

---

## License

Use and modify as needed for your project. Note: WireGuard is licensed under the GPL; ensure your use complies with it.
